<div th:fragment="songlist(showVoteButtons)">

  <div th:if="${!#lists.isEmpty(songqueue)}"
       class="flex flex-col divide-y divide-[#282828]" id="song-list">

    <div th:each="song : ${songqueue}"
         class="flex items-center justify-between py-4 hover:bg-[#232323] px-3 rounded-lg transition">
      <div class="flex items-center gap-4">
        <!-- Album Art -->
        <img th:if="${song.albumArtUrl != null}" th:src="${song.albumArtUrl}" alt="Album Art"
             class="w-16 h-16 rounded-lg object-cover" />

        <div th:if="${song.albumArtUrl == null}" class="w-16 h-16 rounded-lg bg-[#2a2a2a] flex items-center justify-center">
          <span class="text-xs text-gray-400">No art</span>
        </div>

        <!-- Song Details -->
        <div class="flex flex-col">
          <h2 th:text="${song.getTitle()}" class="font-semibold">Song Title</h2>
          <p th:text="${song.getArtist()}" class="text-gray-400 text-sm">Artist Name</p>
        </div>
      </div>

      <!-- Voting + Veto Section -->
      <div class="flex items-center gap-4">
        <!-- Upvote -->
        <form th:action="@{/vote}" method="post" class="vote-form flex items-center gap-2" th:if="${showVoteButtons}">
          <input type="hidden" name="songId" th:value="${song.getId()}"/>
          <button type="submit" name="vote" value="up"
                  class="text-green-500 hover:scale-110 transition"
                  th:classappend="${userVotes[song.getId()] == 1} ? ' opacity-50 ' : ''">
            ▲
          </button>
        </form>

        <span class="vote-count text-lg font-semibold" th:text="${song.getVotes()}">0</span>

        <!-- Downvote -->
        <form th:action="@{/vote}" method="post" class="vote-form flex items-center gap-2" th:if="${showVoteButtons}">
          <input type="hidden" name="songId" th:value="${song.getId()}"/>
          <button type="submit" name="vote" value="down"
                  class="text-red-500 hover:scale-110 transition"
                  th:classappend="${userVotes[song.getId()] == -1} ? ' opacity-50 ' : ''">
            ▼
          </button>
        </form>

        <!-- Veto Section -->
        <th:block th:if="${(userVetoes != null ? (userVetoes['USED'] ?: 0) : 0) < (vetoesPerPlayer ?: 0)}">
          <form th:action="@{/vote/veto}" method="post"
                class="flex items-center gap-2">

            <input type="hidden" name="songId" th:value="${song.getId()}"/>

            <button type="submit"
                    class="px-2 py-1 rounded-md bg-red-700/40 text-red-400 text-sm font-semibold
               hover:bg-red-600/60 hover:text-red-200 transition">
              Veto
            </button>

            <!-- Veto count badge -->
            <span class="text-xs text-gray-400"
                  th:if="${song.getVetoCount() > 0}">
        <span th:text="${song.getVetoCount()}">0</span> /
        <span th:text="${vetoThreshold}">?</span>
    </span>
          </form>
        </th:block>

      </div>

    </div>
  </div>

  <p th:if="${#lists.isEmpty(songqueue)}"
     class="text-center text-gray-500 italic py-4">
    No songs in queue yet. Add a playlist on the dashboard first!
  </p>
</div>